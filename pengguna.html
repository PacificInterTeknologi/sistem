<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manajemen Pengguna - PACIFI PRO</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #1B1F3B;
      --secondary-color: #8B0000;
      --accent-color: #4285f4;
      --light-color: #f8f9fa;
      --border-color: #e0e0e0;
      --text-color: #333;
      --success-color: #34a853;
      --danger-color: #ea4335;
      --warning-color: #fbbc05;
      --sidebar-width: 250px;
      --header-height: 70px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header Styles */
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
      height: var(--header-height);
    }
    
    .logo-container {
      display: flex;
      align-items: center;
    }
    
    .brand {
      font-size: 24px;
      font-weight: bold;
      margin-left: 15px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .user-name {
      margin-right: 15px;
      font-size: 14px;
    }
    
    .logout-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .logout-btn:hover {
      background: #c5221f;
    }
    
    /* Sidebar Styles */
    .sidebar {
      width: var(--sidebar-width);
      background-color: white;
      height: calc(100vh - var(--header-height));
      position: fixed;
      left: 0;
      top: var(--header-height);
      box-shadow: 2px 0 5px rgba(0,0,0,0.05);
      overflow-y: auto;
      z-index: 90;
      transition: transform 0.3s;
    }
    
    .sidebar-menu {
      list-style: none;
      padding: 20px 0;
    }
    
    .sidebar-menu li {
      margin-bottom: 5px;
    }
    
    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: var(--text-color);
      text-decoration: none;
      transition: background 0.3s;
    }
    
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background-color: var(--light-color);
      color: var(--primary-color);
    }
    
    .sidebar-menu i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    /* Main Content Styles */
    .main-content {
      margin-left: var(--sidebar-width);
      padding: 20px;
      flex: 1;
      transition: margin-left 0.3s;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    /* Breadcrumb Styles */
    .breadcrumb {
      display: flex;
      align-items: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }
    
    .breadcrumb a {
      color: var(--accent-color);
      text-decoration: none;
    }
    
    .breadcrumb a:hover {
      text-decoration: underline;
    }
    
    .breadcrumb i {
      margin: 0 8px;
      font-size: 12px;
    }
    
    /* Card Styles */
    .card {
      background-color: white;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    /* Form Styles */
    .form-section {
      background: var(--light-color);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    
    .form-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
    }
    
    .form-title i {
      margin-right: 10px;
      color: var(--primary-color);
    }
    
    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
    }
    
    .form-group {
      flex: 1;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .form-group input, .form-group select {
      width: 100%;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.2);
    }
    
    /* Button Styles */
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      min-height: 44px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #0d0e1f;
    }
    
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #5a6268;
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
      padding: 8px 12px;
      font-size: 13px;
    }
    
    .btn-danger:hover {
      background-color: #c5221f;
    }
    
    .btn-success {
      background-color: var(--success-color);
      color: white;
      padding: 8px 12px;
      font-size: 13px;
    }
    
    .btn-success:hover {
      background-color: #2d8e47;
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      color: white;
      padding: 8px 12px;
      font-size: 13px;
    }
    
    .btn-warning:hover {
      background-color: #e0a800;
    }
    
    .btn-icon {
      margin-right: 8px;
    }
    
    /* Table Styles */
    .table-section {
      margin-top: 30px;
    }
    
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .table-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
      display: flex;
      align-items: center;
    }
    
    .table-title i {
      margin-right: 10px;
    }
    
    .search-box {
      position: relative;
      width: 250px;
    }
    
    .search-box input {
      width: 100%;
      padding: 10px 40px 10px 15px;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      font-size: 14px;
    }
    
    .search-box i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #999;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.5px;
      cursor: pointer;
      user-select: none;
    }
    
    th:hover {
      background-color: #0d0e1f;
    }
    
    th i {
      margin-left: 5px;
      font-size: 12px;
    }
    
    tr:nth-child(even) {
      background-color: var(--light-color);
    }
    
    tr:hover {
      background-color: #f1f3f9;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    
    .empty-state i {
      font-size: 48px;
      margin-bottom: 15px;
      color: #ccc;
    }
    
    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 6px;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      transform: translateY(-100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification.success {
      background-color: var(--success-color);
    }
    
    .notification.error {
      background-color: var(--danger-color);
    }
    
    .notification.warning {
      background-color: var(--warning-color);
    }
    
    /* Pagination Styles */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
      gap: 5px;
    }
    
    .pagination button {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      background: white;
      color: var(--text-color);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .pagination button:hover {
      background: var(--light-color);
    }
    
    .pagination button.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .pagination-info {
      margin: 0 15px;
      font-size: 14px;
      color: #666;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 0;
      border-radius: 8px;
      width: 500px;
      max-width: 90%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .modal-header {
      padding: 15px 20px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 8px 8px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      margin: 0;
      font-size: 18px;
    }
    
    .close {
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close:hover {
      opacity: 0.7;
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Badge Styles */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-admin {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--danger-color);
    }
    
    .badge-staff {
      background-color: rgba(66, 133, 244, 0.1);
      color: var(--accent-color);
    }
    
    .badge-active {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--success-color);
    }
    
    .badge-inactive {
      background-color: rgba(158, 158, 158, 0.1);
      color: #666;
    }
    
    /* Session Timer Styles */
    .session-timer {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--primary-color);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Switch Styles */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--success-color);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    /* Menu Toggle */
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
    
    /* Responsive Styles */
    @media screen and (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding: 15px;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .table-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .search-box {
        width: 100%;
      }
      
      table {
        font-size: 14px;
      }
      
      th, td {
        padding: 10px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .modal-content {
        width: 95%;
        margin: 15% auto;
      }
      
      .pagination {
        flex-wrap: wrap;
      }
      
      .session-timer {
        bottom: 10px;
        right: 10px;
        font-size: 12px;
        padding: 8px 12px;
      }
      
      .brand {
        font-size: 18px;
      }
      
      .user-name {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Check Login -->
  <script>
    // Check if user is logged in
    const currentUser = localStorage.getItem("currentUser");
    if (!currentUser) {
      window.location.href = "login.html";
    }
  </script>

  <!-- Header -->
  <div class="header">
    <div class="logo-container">
      <button class="menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="brand">PACIFI PRO</div>
    </div>
    <div class="user-info">
      <div class="user-name" id="userWelcome">Loading...</div>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <ul class="sidebar-menu">
      <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="pelanggan.html"><i class="fas fa-users"></i> Data Pelanggan</a></li>
      <li><a href="jenis-invoice.html"><i class="fas fa-file-alt"></i> Jenis Invoice</a></li>
      <li><a href="invoice.html"><i class="fas fa-receipt"></i> Invoice</a></li>
      <li><a href="laporan-penjualan.html"><i class="fas fa-chart-line"></i> Laporan Penjualan</a></li>
      <li><a href="program_keuangan_akun.html"><i class="fas fa-coins"></i> Input Akun</a></li>
      <li><a href="program_keuangan_jurnal.html"><i class="fas fa-book"></i> Jurnal</a></li>
      <li><a href="program_keuangan_laporan.html"><i class="fas fa-chart-pie"></i> Laporan Keuangan</a></li>
      <li><a href="neraca.html"><i class="fas fa-balance-scale"></i> Neraca</a></li>
      <li><a href="laba_rugi.html"><i class="fas fa-chart-line"></i> Laba Rugi</a></li>
      <li><a href="arus_kas.html"><i class="fas fa-money-bill-wave"></i> Arus Kas</a></li>
      <li><a href="pengguna.html" id="linkPengguna" style="display: none;"><i class="fas fa-user-cog"></i> Manajemen Pengguna</a></li>
    </ul>
  </div>
  
  <!-- Main Content -->
  <div class="main-content">
    <div class="container">
      <div class="breadcrumb">
        <a href="dashboard.html">Dashboard</a>
        <i class="fas fa-chevron-right"></i>
        <span>Manajemen Pengguna</span>
      </div>
      
      <h2>Manajemen Pengguna</h2>
      
      <div class="form-section">
        <h3 class="form-title">
          <i class="fas fa-user-plus"></i>
          Tambah Pengguna Baru
        </h3>
        <div class="form-row">
          <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" placeholder="Masukkan username" />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Masukkan password" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="role">Role</label>
            <select id="role">
              <option value="staff">Staff</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label for="status">Status</label>
            <select id="status">
              <option value="active">Aktif</option>
              <option value="inactive">Nonaktif</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>&nbsp;</label>
            <button class="btn btn-primary" onclick="tambahUser()">
              <i class="fas fa-plus btn-icon"></i> Tambah Pengguna
            </button>
          </div>
        </div>
      </div>
      
      <div class="table-section">
        <div class="table-header">
          <h3 class="table-title">
            <i class="fas fa-users"></i>
            Daftar Pengguna
          </h3>
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="Cari pengguna..." onkeyup="searchUsers()">
            <i class="fas fa-search"></i>
          </div>
        </div>
        
        <table>
          <thead>
            <tr>
              <th>No</th>
              <th onclick="sortTable(1)">Username <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(2)">Role <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(3)">Status <i class="fas fa-sort"></i></th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="userList"></tbody>
        </table>
        
        <div id="emptyState" class="empty-state" style="display: none;">
          <i class="fas fa-users-slash"></i>
          <p>Belum ada data pengguna</p>
        </div>
        
        <div id="pagination" class="pagination" style="display: none;"></div>
      </div>
    </div>
  </div>
  
  <!-- Edit User Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Pengguna</h3>
        <span class="close" onclick="closeEditModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="editUsername">Username</label>
          <input type="text" id="editUsername" readonly />
        </div>
        <div class="form-group">
          <label for="editPassword">Password (Kosongkan jika tidak diubah)</label>
          <input type="password" id="editPassword" placeholder="Masukkan password baru" />
        </div>
        <div class="form-group">
          <label for="editRole">Role</label>
          <select id="editRole">
            <option value="staff">Staff</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editStatus">Status Akun</label>
          <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
            <span>Nonaktif</span>
            <label class="switch">
              <input type="checkbox" id="editStatusSwitch">
              <span class="slider"></span>
            </label>
            <span>Aktif</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="saveEditUser()">
          <i class="fas fa-save btn-icon"></i> Simpan Perubahan
        </button>
        <button class="btn btn-secondary" onclick="closeEditModal()">
          <i class="fas fa-times btn-icon"></i> Batal
        </button>
      </div>
    </div>
  </div>
  
  <!-- Status Confirmation Modal -->
  <div id="statusModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="statusModalTitle">Konfirmasi Perubahan Status</h3>
        <span class="close" onclick="closeStatusModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p id="statusModalMessage">Apakah Anda yakin ingin mengubah status akun ini?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="confirmStatusBtn">
          <i class="fas fa-check btn-icon"></i> Ya, Ubah Status
        </button>
        <button class="btn btn-secondary" onclick="closeStatusModal()">
          <i class="fas fa-times btn-icon"></i> Batal
        </button>
      </div>
    </div>
  </div>
  
  <div id="notification" class="notification"></div>
  
  <div id="sessionTimer" class="session-timer" style="display: none;">
    <i class="fas fa-clock"></i>
    <span>Sesi Anda tersisa: <span id="timeRemaining">30:00</span></span>
  </div>
  
  <script>
    // Global variables
    let users = [];
    let filteredUsers = [];
    let currentPage = 1;
    const rowsPerPage = 5;
    let sortColumn = 0;
    let sortDirection = 'asc';
    let editingIndex = -1;
    let sessionTimer;
    let statusChangeIndex = -1;
    let newStatus = '';
    
    // Check authentication
    const userLogin = JSON.parse(localStorage.getItem("currentUser"));
    if (!userLogin || userLogin.role !== "admin") {
      showNotification("Hanya admin yang dapat mengakses halaman ini.", "error");
      setTimeout(() => {
        window.location.href = "dashboard.html";
      }, 2000);
    } else {
      // Start session timer
      startSessionTimer();
    }
    
    // Initialize page
    document.addEventListener("DOMContentLoaded", function() {
      loadUsers();
      
      // Event listener for Enter key on form
      document.getElementById("password").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
          tambahUser();
        }
      });
      
      // Event listener for status switch in edit modal
      document.getElementById("editStatusSwitch").addEventListener("change", function() {
        document.getElementById("editStatus").value = this.checked ? "active" : "inactive";
      });
    });
    
    // Toggle sidebar function
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
    }
    
    // Logout function
    function logout() {
      localStorage.removeItem("currentUser");
      window.location.href = "index.html";
    }
    
    // Session management
    function startSessionTimer() {
      const loginTime = userLogin.loginTime || new Date().getTime();
      const sessionDuration = 30 * 60 * 1000; // 30 minutes in milliseconds
      
      // Update login time if not exists
      if (!userLogin.loginTime) {
        userLogin.loginTime = loginTime;
        localStorage.setItem("currentUser", JSON.stringify(userLogin));
      }
      
      // Show session timer
      document.getElementById("sessionTimer").style.display = "flex";
      
      // Update timer every second
      sessionTimer = setInterval(() => {
        const currentTime = new Date().getTime();
        const elapsedTime = currentTime - loginTime;
        const remainingTime = sessionDuration - elapsedTime;
        
        if (remainingTime <= 0) {
          // Session expired
          clearInterval(sessionTimer);
          localStorage.removeItem("currentUser");
          showNotification("Sesi Anda telah habis. Silakan login kembali.", "warning");
          setTimeout(() => {
            window.location.href = "login.html";
          }, 3000);
          return;
        }
        
        // Update timer display
        const minutes = Math.floor(remainingTime / 60000);
        const seconds = Math.floor((remainingTime % 60000) / 1000);
        document.getElementById("timeRemaining").textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }, 1000);
    }
    
    // Show notification function
    function showNotification(message, type = 'success') {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add("show");
      
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }
    
    // Load users from localStorage
    function loadUsers() {
      users = JSON.parse(localStorage.getItem("users")) || [];
      
      // Add status field to existing users if not exists
      users.forEach(user => {
        if (user.status === undefined) {
          user.status = "active";
        }
      });
      
      // Save back to localStorage
      localStorage.setItem("users", JSON.stringify(users));
      
      filteredUsers = [...users];
      currentPage = 1;
      renderTable();
      
      // Update user welcome message
      document.getElementById("userWelcome").textContent = userLogin.fullName + " (" + userLogin.role + ")";
      
      // Show admin link if user is admin
      if (userLogin.role === "admin") {
        document.getElementById("linkPengguna").style.display = "block";
      }
    }
    
    // Render table with pagination
    function renderTable() {
      const tbody = document.getElementById("userList");
      const emptyState = document.getElementById("emptyState");
      const pagination = document.getElementById("pagination");
      
      tbody.innerHTML = "";
      
      if (filteredUsers.length === 0) {
        emptyState.style.display = "block";
        pagination.style.display = "none";
        return;
      }
      
      emptyState.style.display = "none";
      pagination.style.display = "flex";
      
      // Calculate pagination
      const totalPages = Math.ceil(filteredUsers.length / rowsPerPage);
      const startIndex = (currentPage - 1) * rowsPerPage;
      const endIndex = Math.min(startIndex + rowsPerPage, filteredUsers.length);
      const paginatedUsers = filteredUsers.slice(startIndex, endIndex);
      
      // Render rows
      paginatedUsers.forEach((user, index) => {
        const actualIndex = users.findIndex(u => u.username === user.username);
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${startIndex + index + 1}</td>
          <td>${user.username}</td>
          <td>
            <span class="badge ${user.role === 'admin' ? 'badge-admin' : 'badge-staff'}">${user.role}</span>
          </td>
          <td>
            <span class="badge ${user.status === 'active' ? 'badge-active' : 'badge-inactive'}">
              ${user.status === 'active' ? 'Aktif' : 'Nonaktif'}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary" onclick="editUser(${actualIndex})" style="padding: 8px 12px; font-size: 13px;">
                <i class="fas fa-edit"></i> Edit
              </button>
              ${user.status === 'active' ? 
                `<button class="btn btn-warning" onclick="confirmStatusChange(${actualIndex}, 'inactive')">
                  <i class="fas fa-lock"></i> Nonaktifkan
                </button>` : 
                `<button class="btn btn-success" onclick="confirmStatusChange(${actualIndex}, 'active')">
                  <i class="fas fa-unlock"></i> Aktifkan
                </button>`
              }
              <button class="btn btn-danger" onclick="hapusUser(${actualIndex})">
                <i class="fas fa-trash-alt"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // Render pagination
      renderPagination(totalPages);
    }
    
    // Render pagination controls
    function renderPagination(totalPages) {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      
      // Previous button
      const prevBtn = document.createElement("button");
      prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable();
        }
      };
      pagination.appendChild(prevBtn);
      
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement("button");
        pageBtn.textContent = i;
        if (i === currentPage) {
          pageBtn.classList.add("active");
        }
        pageBtn.onclick = () => {
          currentPage = i;
          renderTable();
        };
        pagination.appendChild(pageBtn);
      }
      
      // Next button
      const nextBtn = document.createElement("button");
      nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable();
        }
      };
      pagination.appendChild(nextBtn);
      
      // Pagination info
      const info = document.createElement("div");
      info.className = "pagination-info";
      const startItem = (currentPage - 1) * rowsPerPage + 1;
      const endItem = Math.min(currentPage * rowsPerPage, filteredUsers.length);
      info.textContent = `Menampilkan ${startItem}-${endItem} dari ${filteredUsers.length} pengguna`;
      pagination.appendChild(info);
    }
    
    // Add new user
    function tambahUser() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const role = document.getElementById("role").value;
      const status = document.getElementById("status").value;
      
      if (!username || !password) {
        showNotification("Harap isi semua kolom!", "error");
        return;
      }
      
      // Check if username already exists
      if (users.some(u => u.username === username)) {
        showNotification("Username sudah digunakan!", "error");
        return;
      }
      
      // Add new user
      users.push({ 
        username, 
        password, 
        role, 
        status,
        fullName: username.charAt(0).toUpperCase() + username.slice(1) // Default fullName
      });
      localStorage.setItem("users", JSON.stringify(users));
      
      // Reset form
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.getElementById("role").value = "staff";
      document.getElementById("status").value = "active";
      
      // Reload users
      loadUsers();
      showNotification("Pengguna berhasil ditambahkan!");
    }
    
    // Edit user
    function editUser(index) {
      const user = users[index];
      document.getElementById("editUsername").value = user.username;
      document.getElementById("editPassword").value = "";
      document.getElementById("editRole").value = user.role;
      document.getElementById("editStatus").value = user.status;
      document.getElementById("editStatusSwitch").checked = user.status === "active";
      
      editingIndex = index;
      document.getElementById("editModal").style.display = "block";
    }
    
    // Close edit modal
    function closeEditModal() {
      document.getElementById("editModal").style.display = "none";
      editingIndex = -1;
    }
    
    // Save edited user
    function saveEditUser() {
      const username = document.getElementById("editUsername").value.trim();
      const password = document.getElementById("editPassword").value.trim();
      const role = document.getElementById("editRole").value;
      const status = document.getElementById("editStatus").value;
      
      if (!username) {
        showNotification("Username tidak boleh kosong!", "error");
        return;
      }
      
      // Update user data
      users[editingIndex].role = role;
      users[editingIndex].status = status;
      if (password) {
        users[editingIndex].password = password;
      }
      
      localStorage.setItem("users", JSON.stringify(users));
      closeEditModal();
      loadUsers();
      showNotification("Pengguna berhasil diperbarui!");
    }
    
    // Confirm status change
    function confirmStatusChange(index, newStatusValue) {
      const user = users[index];
      statusChangeIndex = index;
      newStatus = newStatusValue;
      
      const modal = document.getElementById("statusModal");
      const title = document.getElementById("statusModalTitle");
      const message = document.getElementById("statusModalMessage");
      const confirmBtn = document.getElementById("confirmStatusBtn");
      
      if (newStatusValue === "active") {
        title.textContent = "Aktifkan Akun";
        message.textContent = `Apakah Anda yakin ingin mengaktifkan akun "${user.username}"?`;
        confirmBtn.innerHTML = '<i class="fas fa-check btn-icon"></i> Ya, Aktifkan';
        confirmBtn.className = "btn btn-success";
      } else {
        title.textContent = "Nonaktifkan Akun";
        message.textContent = `Apakah Anda yakin ingin menonaktifkan akun "${user.username}"?`;
        confirmBtn.innerHTML = '<i class="fas fa-check btn-icon"></i> Ya, Nonaktifkan';
        confirmBtn.className = "btn btn-warning";
      }
      
      // Prevent self-deactivation
      if (userLogin.username === user.username && newStatusValue === "inactive") {
        showNotification("Anda tidak dapat menonaktifkan akun Anda sendiri!", "error");
        return;
      }
      
      modal.style.display = "block";
      
      // Set up confirm button
      confirmBtn.onclick = function() {
        changeUserStatus(statusChangeIndex, newStatus);
        closeStatusModal();
      };
    }
    
    // Close status modal
    function closeStatusModal() {
      document.getElementById("statusModal").style.display = "none";
      statusChangeIndex = -1;
      newStatus = '';
    }
    
    // Change user status
    function changeUserStatus(index, newStatusValue) {
      users[index].status = newStatusValue;
      localStorage.setItem("users", JSON.stringify(users));
      loadUsers();
      
      if (newStatusValue === "active") {
        showNotification("Akun berhasil diaktifkan!");
      } else {
        showNotification("Akun berhasil dinonaktifkan!");
      }
    }
    
    // Delete user
    function hapusUser(index) {
      const user = users[index];
      
      // Prevent self-deletion
      if (userLogin.username === user.username) {
        showNotification("Anda tidak dapat menghapus akun Anda sendiri!", "error");
        return;
      }
      
      if (confirm(`Yakin ingin menghapus pengguna "${user.username}"?`)) {
        users.splice(index, 1);
        localStorage.setItem("users", JSON.stringify(users));
        loadUsers();
        showNotification("Pengguna berhasil dihapus!");
      }
    }
    
    // Search users
    function searchUsers() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      
      if (searchValue === "") {
        filteredUsers = [...users];
      } else {
        filteredUsers = users.filter(user => 
          user.username.toLowerCase().includes(searchValue) || 
          user.role.toLowerCase().includes(searchValue) ||
          (user.status === "active" && "aktif".includes(searchValue)) ||
          (user.status === "inactive" && "nonaktif".includes(searchValue))
        );
      }
      
      currentPage = 1;
      renderTable();
    }
    
    // Sort table
    function sortTable(column) {
      if (sortColumn === column) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = column;
        sortDirection = 'asc';
      }
      
      filteredUsers.sort((a, b) => {
        let valueA, valueB;
        
        if (column === 1) { // Username
          valueA = a.username.toLowerCase();
          valueB = b.username.toLowerCase();
        } else if (column === 2) { // Role
          valueA = a.role.toLowerCase();
          valueB = b.role.toLowerCase();
        } else if (column === 3) { // Status
          valueA = a.status.toLowerCase();
          valueB = b.status.toLowerCase();
        }
        
        if (valueA < valueB) {
          return sortDirection === 'asc' ? -1 : 1;
        }
        if (valueA > valueB) {
          return sortDirection === 'asc' ? 1 : -1;
        }
        return 0;
      });
      
      renderTable();
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
      const editModal = document.getElementById("editModal");
      const statusModal = document.getElementById("statusModal");
      
      if (event.target === editModal) {
        closeEditModal();
      }
      
      if (event.target === statusModal) {
        closeStatusModal();
      }
    }
  </script>
</body>
</html>