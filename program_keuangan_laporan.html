<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laporan Keuangan - PACIFI PRO</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #1a365d;
      --secondary-color: #8B0000;
      --accent-color: #3182ce;
      --light-color: #ebf8ff;
      --border-color: #e2e8f0;
      --text-color: #2d3748;
      --text-light: #718096;
      --success-color: #38a169;
      --danger-color: #e53e3e;
      --warning-color: #dd6b20;
      --sidebar-width: 260px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
    }
    
    .header {
      background-color: var(--primary-color);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      height: 70px;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
    }
    
    .brand {
      font-size: 24px;
      font-weight: bold;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .user-name {
      margin-right: 15px;
      font-size: 14px;
    }
    
    .logout-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .logout-btn:hover {
      background: #c5221f;
    }
    
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--primary-color);
      color: white;
      position: fixed;
      height: calc(100vh - 70px);
      left: 0;
      top: 70px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.05);
      overflow-y: auto;
      z-index: 90;
      transition: transform 0.3s;
    }
    
    .sidebar-menu {
      list-style: none;
      padding: 20px 0;
    }
    
    .sidebar-menu li {
      margin-bottom: 5px;
    }
    
    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      transition: all 0.3s;
      border-left: 3px solid transparent;
    }
    
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background-color: rgba(255,255,255,0.1);
      color: white;
      border-left: 3px solid var(--accent-color);
    }
    
    .sidebar-menu i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .main-content {
      margin-left: var(--sidebar-width);
      padding: 100px 20px 20px;
      min-height: 100vh;
      width: calc(100% - var(--sidebar-width));
    }
    
    .page-header {
      margin-bottom: 30px;
    }
    
    .page-title {
      font-size: 28px;
      color: var(--primary-color);
      margin-bottom: 5px;
    }
    
    .page-subtitle {
      color: #666;
      font-size: 14px;
    }
    
    .controls {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .controls-row {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .control-group label {
      font-size: 14px;
      font-weight: 500;
      color: #666;
    }
    
    .control-group input, .control-group select {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 14px;
    }
    
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #0d0e1f;
    }
    
    .btn-success {
      background-color: var(--success-color);
      color: white;
    }
    
    .btn-success:hover {
      background-color: #2d8e47;
    }
    
    .btn-info {
      background-color: var(--accent-color);
      color: white;
    }
    
    .btn-info:hover {
      background-color: #3367d6;
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #c5221f;
    }
    
    .table-container {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .table-title {
      font-size: 18px;
      color: var(--primary-color);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    th {
      background-color: var(--light-color);
      font-weight: 600;
      color: var(--primary-color);
    }
    
    tr:hover {
      background-color: rgba(0, 0, 0, 0.02);
    }
    
    .chart-container {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 18px;
      color: var(--primary-color);
    }
    
    .chart-options {
      display: flex;
      gap: 10px;
    }
    
    .chart-option {
      padding: 5px 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
      font-size: 12px;
    }
    
    .chart-option.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }
    
    .chart-wrapper {
      height: 400px;
      position: relative;
    }
    
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background-color: var(--success-color);
      color: white;
      border-radius: 5px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      transform: translateY(-100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification.error {
      background-color: var(--danger-color);
    }
    
    .notification.info {
      background-color: var(--accent-color);
    }
    
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        width: 100%;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .controls-row {
        flex-direction: column;
        align-items: stretch;
      }
    }
    
    @media print {
      .header, .sidebar, .controls, .btn {
        display: none !important;
      }
      
      .main-content {
        margin-left: 0;
        padding: 0;
        width: 100%;
      }
      
      .table-container, .chart-container {
        box-shadow: none;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-container">
      <button class="menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="brand">PACIFI PRO</div>
    </div>
    <div class="user-info">
      <div class="user-name" id="userWelcome">Loading...</div>
      <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>
  
  <div class="sidebar" id="sidebar">
    <ul class="sidebar-menu">
      <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="pelanggan.html"><i class="fas fa-users"></i> Data Pelanggan</a></li>
      <li><a href="jenis-invoice.html"><i class="fas fa-file-alt"></i> Jenis Invoice</a></li>
      <li><a href="invoice.html"><i class="fas fa-receipt"></i> Invoice</a></li>
      <li><a href="laporan-penjualan.html"><i class="fas fa-chart-line"></i> Laporan Penjualan</a></li>
      <li><a href="program_keuangan_akun.html"><i class="fas fa-coins"></i> Input Akun</a></li>
      <li><a href="program_keuangan_jurnal.html"><i class="fas fa-book"></i> Jurnal</a></li>
      <li><a href="program_keuangan_laporan.html" class="active"><i class="fas fa-chart-pie"></i> Laporan Keuangan</a></li>
      <li><a href="laba.html"><i class="fas fa-chart-line"></i> Laba Rugi</a></li>
      <li><a href="arus_kas.html"><i class="fas fa-money-bill-wave"></i> Arus Kas</a></li>
      <li><a href="neraca.html"><i class="fas fa-balance-scale"></i> Neraca</a></li>
      <li><a href="pengguna.html" id="linkPengguna" style="display: none;"><i class="fas fa-user-cog"></i> Manajemen Pengguna</a></li>
    </ul>
  </div>
  
  <div class="main-content">
    <div class="page-header">
      <h1 class="page-title">Laporan Keuangan</h1>
      <p class="page-subtitle">Laporan transaksi keuangan perusahaan</p>
    </div>
    
    <div class="controls">
      <div class="controls-row">
        <div class="control-group">
          <label>Filter Tanggal</label>
          <input type="date" id="filterTanggal" />
        </div>
        <div class="control-group">
          <label>Akun</label>
          <select id="filterAkun">
            <option value="">Semua Akun</option>
            <option value="Penjualan">Penjualan</option>
            <option value="Beban Operasional">Beban Operasional</option>
            <option value="Kas">Kas</option>
            <option value="Bank">Bank</option>
            <option value="Piutang Usaha">Piutang Usaha</option>
            <option value="Utang Usaha">Utang Usaha</option>
          </select>
        </div>
        <div class="control-group">
          <label>Periode</label>
          <select id="filterPeriode">
            <option value="">Semua Periode</option>
            <option value="7">7 Hari Terakhir</option>
            <option value="30">30 Hari Terakhir</option>
            <option value="90">90 Hari Terakhir</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="tampilkanLaporan()">
          <i class="fas fa-sync-alt"></i> Tampilkan
        </button>
        <button class="btn btn-success" onclick="sinkronkanNeraca()">
          <i class="fas fa-sync"></i> Sinkronkan Neraca
        </button>
        <button class="btn btn-info" onclick="exportToExcel()">
          <i class="fas fa-file-excel"></i> Export Excel
        </button>
        <button class="btn btn-info" onclick="exportToPDF()">
          <i class="fas fa-file-pdf"></i> Export PDF
        </button>
      </div>
    </div>
    
    <div class="table-container">
      <div class="table-header">
        <div class="table-title">Data Laporan Keuangan</div>
      </div>
      <table id="tabelLaporan">
        <thead>
          <tr>
            <th>No</th>
            <th>Tanggal</th>
            <th>Deskripsi</th>
            <th>Akun</th>
            <th>Jumlah</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="laporanTransaksi">
          <tr>
            <td colspan="7" style="text-align: center; padding: 20px; color: #666;">Memuat data...</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">Grafik Laporan Keuangan</div>
        <div class="chart-options">
          <div class="chart-option active" onclick="ubahTipeGrafik('bar', this)">Bar</div>
          <div class="chart-option" onclick="ubahTipeGrafik('line', this)">Line</div>
          <div class="chart-option" onclick="ubahTipeGrafik('pie', this)">Pie</div>
        </div>
      </div>
      <div class="chart-wrapper">
        <canvas id="grafikLaporan"></canvas>
      </div>
    </div>
  </div>
  
  <div id="notification" class="notification"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // =====================
    // USER LOGIN & ROLE MANAGEMENT
    // =====================
    const users = [
      { username: "admin", password: "1234", role: "admin", fullName: "Administrator" },
      { username: "staff", password: "staff123", role: "staff", fullName: "Staff" },
      { username: "viewer", password: "viewer123", role: "viewer", fullName: "Viewer" }
    ];
    
    /**
     * Login user dan simpan ke localStorage
     * @param {string} username - Username user
     * @param {string} password - Password user
     * @returns {object|null} User object jika berhasil, null jika gagal
     */
    function loginUser(username, password) {
      const user = users.find(u => u.username === username && u.password === password);
      if (user) {
        // Simpan user ke localStorage tanpa password untuk keamanan
        const userWithoutPassword = { ...user };
        delete userWithoutPassword.password;
        localStorage.setItem("currentUser", JSON.stringify(userWithoutPassword));
        return userWithoutPassword;
      } else {
        showNotification("Username atau password salah", "error");
        return null;
      }
    }
    
    /**
     * Mendapatkan user yang sedang login
     * @returns {object|null} User object jika ada, null jika belum login
     */
    function getCurrentUser() {
      const saved = localStorage.getItem("currentUser");
      return saved ? JSON.parse(saved) : null;
    }
    
    /**
     * Cek apakah user memiliki otorisasi untuk mengakses halaman
     * @param {string[]} allowedRoles - Daftar role yang diizinkan
     * @returns {boolean} True jika diizinkan, false jika tidak
     */
    function isAuthorized(allowedRoles = []) {
      const user = getCurrentUser();
      return user && allowedRoles.includes(user.role);
    }
    
    /**
     * Tampilkan notifikasi kepada user
     * @param {string} message - Pesan notifikasi
     * @param {string} type - Tipe notifikasi (success, error, info, warning)
     */
    function showNotification(message, type = "info") {
      // Cek apakah ada container notifikasi
      let notificationContainer = document.getElementById("notificationContainer");
      
      if (!notificationContainer) {
        // Buat container notifikasi jika belum ada
        notificationContainer = document.createElement("div");
        notificationContainer.id = "notificationContainer";
        notificationContainer.style.position = "fixed";
        notificationContainer.style.top = "20px";
        notificationContainer.style.right = "20px";
        notificationContainer.style.zIndex = "9999";
        document.body.appendChild(notificationContainer);
      }
      
      // Buat elemen notifikasi
      const notification = document.createElement("div");
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      
      // Style untuk notifikasi
      notification.style.padding = "12px 20px";
      notification.style.marginBottom = "10px";
      notification.style.borderRadius = "4px";
      notification.style.color = "white";
      notification.style.boxShadow = "0 2px 10px rgba(0,0,0,0.2)";
      notification.style.transform = "translateX(120%)";
      notification.style.transition = "transform 0.3s ease";
      
      // Warna berdasarkan tipe
      const colors = {
        success: "#38a169",
        error: "#e53e3e",
        info: "#3182ce",
        warning: "#dd6b20"
      };
      notification.style.backgroundColor = colors[type] || colors.info;
      
      // Tambahkan ke container
      notificationContainer.appendChild(notification);
      
      // Animasi muncul
      setTimeout(() => {
        notification.style.transform = "translateX(0)";
      }, 10);
      
      // Hapus otomatis setelah 3 detik
      setTimeout(() => {
        notification.style.transform = "translateX(120%)";
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }
    
    // =====================
    // FUNGSI UTAMA
    // =====================
    
    // Fungsi untuk toggle sidebar
    function toggleSidebar() {
      document.getElementById("sidebar").classList.toggle("active");
    }
    
    // Fungsi logout
    function logout() {
      localStorage.removeItem("currentUser");
      showNotification("Anda telah berhasil logout");
      window.location.href = "index.html";
    }
    
    // Cek user login dan tampilkan nama
    window.onload = function() {
      const user = getCurrentUser();
      if (!user) {
        showNotification("Silakan login terlebih dahulu", "error");
        window.location.href = "index.html";
        return;
      }
      
      // Update info user di header
      document.getElementById("userWelcome").textContent = `Login sebagai: ${user.username} (${user.role})`;
      
      // Tampilkan menu manajemen pengguna hanya untuk admin
      if (user.role === "admin") {
        document.getElementById("linkPengguna").style.display = "block";
      }
      
      // Set today's date as default
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("filterTanggal").value = today;
      
      // Load laporan data
      tampilkanLaporan();
    };
    
    // Fungsi untuk menampilkan laporan
    function tampilkanLaporan() {
      const data = JSON.parse(localStorage.getItem("dataLaporan")) || [];
      const tbody = document.getElementById("laporanTransaksi");
      const filterTanggal = document.getElementById("filterTanggal").value;
      const filterAkun = document.getElementById("filterAkun").value;
      const filterPeriode = document.getElementById("filterPeriode").value;
      
      tbody.innerHTML = "";
      let no = 1;
      let grafikData = {};
      
      // Filter data berdasarkan kriteria
      let filteredData = data;
      
      if (filterTanggal) {
        filteredData = filteredData.filter(item => item.tanggal === filterTanggal);
      }
      
      if (filterAkun) {
        filteredData = filteredData.filter(item => item.akun === filterAkun);
      }
      
      if (filterPeriode) {
        const today = new Date();
        const filterDate = new Date();
        filterDate.setDate(today.getDate() - parseInt(filterPeriode));
        
        filteredData = filteredData.filter(item => {
          const itemDate = new Date(item.tanggal);
          return itemDate >= filterDate && itemDate <= today;
        });
      }
      
      // Tampilkan data di tabel
      if (filteredData.length === 0) {
        tbody.innerHTML = "<tr><td colspan='7' style='text-align: center; padding: 20px; color: #666;'>Tidak ada data laporan</td></tr>";
      } else {
        filteredData.forEach((item, index) => {
          const statusClass = item.status === 'debit' ? 'status-debit' : 'status-kredit';
          const statusText = item.status === 'debit' ? 'Debit' : 'Kredit';
          
          tbody.innerHTML += `
            <tr>
              <td>${no++}</td>
              <td>${item.tanggal}</td>
              <td>${item.deskripsi}</td>
              <td>${item.akun}</td>
              <td>Rp ${parseFloat(item.jumlah).toLocaleString('id-ID')}</td>
              <td><span class="${statusClass}">${statusText}</span></td>
              <td>
                <button class="btn btn-danger" onclick="hapusSatuLaporan(${index})">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
          
          // Siapkan data untuk grafik
          if (!grafikData[item.akun]) grafikData[item.akun] = 0;
          grafikData[item.akun] += parseFloat(item.jumlah);
        });
      }
      
      // Tampilkan grafik
      tampilkanGrafik(grafikData);
    }
    
    // Fungsi untuk menampilkan grafik
    let currentChart = null;
    let currentChartType = 'bar';
    
    function tampilkanGrafik(data) {
      const ctx = document.getElementById("grafikLaporan").getContext("2d");
      
      // Destroy previous chart if exists
      if (currentChart) {
        currentChart.destroy();
      }
      
      // Prepare data for chart
      const labels = Object.keys(data);
      const values = Object.values(data);
      
      // Create chart based on current type
      const chartConfig = {
        type: currentChartType,
        data: {
          labels: labels,
          datasets: [{
            label: "Total per Akun",
            data: values,
            backgroundColor: [
              'rgba(26, 54, 93, 0.7)',
              'rgba(139, 0, 0, 0.7)',
              'rgba(49, 130, 206, 0.7)',
              'rgba(56, 168, 83, 0.7)',
              'rgba(221, 187, 5, 0.7)',
              'rgba(229, 67, 53, 0.7)'
            ],
            borderColor: [
              'rgb(26, 54, 93)',
              'rgb(139, 0, 0)',
              'rgb(49, 130, 206)',
              'rgb(56, 168, 83)',
              'rgb(221, 187, 5)',
              'rgb(229, 67, 53)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Rp ${context.raw.toLocaleString('id-ID')}`;
                }
              }
            }
          },
          scales: currentChartType !== 'pie' ? {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'Rp ' + value.toLocaleString('id-ID');
                }
              }
            }
          } : {}
        }
      };
      
      currentChart = new Chart(ctx, chartConfig);
    }
    
    // Fungsi untuk mengubah tipe grafik
    function ubahTipeGrafik(type, element) {
      currentChartType = type;
      
      // Update active class
      document.querySelectorAll('.chart-option').forEach(option => {
        option.classList.remove('active');
      });
      element.classList.add('active');
      
      // Refresh chart
      tampilkanLaporan();
    }
    
    // Fungsi untuk menghapus satu laporan
    function hapusSatuLaporan(index) {
      const data = JSON.parse(localStorage.getItem("dataLaporan")) || [];
      
      if (confirm("Apakah Anda yakin ingin menghapus data laporan ini?")) {
        data.splice(index, 1);
        localStorage.setItem("dataLaporan", JSON.stringify(data));
        tampilkanLaporan();
        showNotification("Data laporan berhasil dihapus");
      }
    }
    
    // Fungsi untuk sinkronkan neraca
    function sinkronkanNeraca() {
      const laporanData = JSON.parse(localStorage.getItem("dataLaporan")) || [];
      
      // Prepare data for neraca
      const neracaData = {
        // Aset
        kas: 0,
        bank: 0,
        piutangUsaha: 0,
        persediaan: 0,
        peralatan: 0,
        
        // Kewajiban
        utangUsaha: 0,
        utangPajak: 0,
        
        // Ekuitas
        modalSaham: 100000000, // Modal awal
        labaDitahan: 0,
        saldoLaba: 0
      };
      
      // Process laporan data to calculate neraca
      laporanData.forEach(entry => {
        const amount = parseFloat(entry.jumlah);
        
        switch(entry.akun) {
          // Aset
          case "Kas":
            neracaData.kas += entry.status === 'debit' ? amount : -amount;
            break;
          case "Bank":
            neracaData.bank += entry.status === 'debit' ? amount : -amount;
            break;
          case "Piutang Usaha":
            neracaData.piutangUsaha += entry.status === 'debit' ? amount : -amount;
            break;
          case "Persediaan":
            neracaData.persediaan += entry.status === 'debit' ? amount : -amount;
            break;
          case "Peralatan":
            neracaData.peralatan += entry.status === 'debit' ? amount : -amount;
            break;
            
          // Kewajiban
          case "Utang Usaha":
            neracaData.utangUsaha += entry.status === 'kredit' ? amount : -amount;
            break;
          case "Utang Pajak":
            neracaData.utangPajak += entry.status === 'kredit' ? amount : -amount;
            break;
            
          // Ekuitas
          case "Modal Saham":
            neracaData.modalSaham += entry.status === 'kredit' ? amount : -amount;
            break;
          case "Laba Ditahan":
            neracaData.labaDitahan += entry.status === 'kredit' ? amount : -amount;
            break;
            
          // Calculate profit/loss
          default:
            if (entry.status === 'debit') {
              neracaData.saldoLaba -= amount; // Expenses reduce equity
            } else {
              neracaData.saldoLaba += amount; // Revenue increases equity
            }
            break;
        }
      });
      
      // Calculate derived values
      neracaData.totalAsetLancar = neracaData.kas + neracaData.bank + neracaData.piutangUsaha + neracaData.persediaan;
      neracaData.totalAsetTidakLancar = neracaData.peralatan;
      neracaData.totalAset = neracaData.totalAsetLancar + neracaData.totalAsetTidakLancar;
      
      neracaData.totalKewajiban = neracaData.utangUsaha + neracaData.utangPajak;
      neracaData.totalEkuitas = neracaData.modalSaham + neracaData.labaDitahan + neracaData.saldoLaba;
      neracaData.totalKewajibanEkuitas = neracaData.totalKewajiban + neracaData.totalEkuitas;
      
      // Save neraca data to localStorage
      localStorage.setItem("dataNeraca", JSON.stringify(neracaData));
      
      showNotification("Neraca berhasil disinkronkan dengan data laporan!");
      
      // Optionally redirect to neraca page
      setTimeout(() => {
        if (confirm("Neraca berhasil disinkronkan. Apakah Anda ingin melihat halaman neraca?")) {
          window.location.href = "neraca.html";
        }
      }, 1000);
    }
    
    // Fungsi untuk export ke Excel
    function exportToExcel() {
      const table = document.getElementById("tabelLaporan");
      const wb = XLSX.utils.table_to_book(table, { sheet: "Laporan Keuangan" });
      XLSX.writeFile(wb, "laporan_keuangan.xlsx");
      showNotification("Laporan berhasil diekspor ke Excel!");
    }
    
    // Fungsi untuk export ke PDF
    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      // Add title
      doc.setFontSize(18);
      doc.text("Laporan Keuangan", 105, 20, { align: "center" });
      
      // Get table data
      const table = document.getElementById("tabelLaporan");
      const rows = table.querySelectorAll("tbody tr");
      
      let yPosition = 30;
      
      // Add headers
      doc.setFontSize(12);
      doc.text("No", 20, yPosition);
      doc.text("Tanggal", 40, yPosition);
      doc.text("Deskripsi", 60, yPosition);
      doc.text("Akun", 100, yPosition);
      doc.text("Jumlah", 140, yPosition);
      doc.text("Status", 170, yPosition);
      
      yPosition += 10;
      
      // Add table rows
      doc.setFontSize(10);
      rows.forEach(row => {
        if (yPosition > 270) {
          doc.addPage();
          yPosition = 20;
        }
        
        const cells = row.querySelectorAll("td");
        if (cells.length >= 6) {
          doc.text(cells[0].innerText, 20, yPosition);
          doc.text(cells[1].innerText, 40, yPosition);
          doc.text(cells[2].innerText.substring(0, 30), 60, yPosition); // Limit text length
          doc.text(cells[3].innerText, 100, yPosition);
          doc.text(cells[4].innerText, 140, yPosition);
          doc.text(cells[5].innerText, 170, yPosition);
          
          yPosition += 8;
        }
      });
      
      doc.save("laporan_keuangan.pdf");
      showNotification("Laporan berhasil diekspor ke PDF!");
    }
    
    // Add CSS for status badges
    const style = document.createElement('style');
    style.textContent = `
      .status-debit {
        background-color: rgba(229, 67, 53, 0.1);
        color: #e53e3e;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }
      
      .status-kredit {
        background-color: rgba(56, 168, 83, 0.1);
        color: #38a169;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>