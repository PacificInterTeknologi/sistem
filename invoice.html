<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice - Pacific Inter Teknologi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #1B1F3B;
      --secondary-color: #8B0000;
      --accent-color: #4285f4;
      --light-color: #f8f9fa;
      --border-color: #e0e0e0;
      --text-color: #333;
      --success-color: #34a853;
      --danger-color: #ea4335;
      --warning-color: #fbbc05;
    }
    
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    body { 
      font-family: 'Segoe UI', sans-serif; 
      margin: 0;
      padding: 15px;
      background-color: #f5f7fa;
      color: var(--text-color);
    }
    
    .invoice-container { 
      max-width: 900px; 
      margin: 0 auto; 
      padding: 25px; 
      border: 1px solid var(--border-color);
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .button-bar { 
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    
    .button-bar button {
      background-color: var(--primary-color); 
      color: white; 
      border: none; 
      padding: 10px 16px;
      border-radius: 5px; 
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
    }
    
    .button-bar button:hover {
      background-color: #0d0e1f;
    }
    
    .button-bar button.danger {
      background-color: var(--danger-color);
    }
    
    .button-bar button.danger:hover {
      background-color: #c5221f;
    }
    
    .button-bar button.success {
      background-color: var(--success-color);
    }
    
    .button-bar button.success:hover {
      background-color: #2d8e47;
    }
    
    .top-bar { 
      display: flex; 
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border-color);
    }
    
    .company-info { 
      font-size: 14px; 
      flex: 1;
    }
    
    .company-info h2 { 
      color: var(--primary-color); 
      margin-bottom: 8px;
      font-size: 24px;
      font-weight: 700;
    }
    
    .company-info p { 
      margin: 4px 0;
      color: #555;
    }
    
    .invoice-title { 
      font-size: 28px; 
      font-weight: bold; 
      color: var(--secondary-color);
      text-transform: uppercase;
      letter-spacing: 1px;
      text-align: right;
      margin-left: auto;
    }
    
    .info-section { 
      display: flex; 
      justify-content: space-between; 
      flex-wrap: wrap; 
      margin-top: 20px;
      gap: 15px;
    }
    
    .info-box { 
      flex: 1;
      min-width: 250px;
      margin-bottom: 15px; 
    }
    
    .info-box label { 
      font-weight: 600; 
      display: block; 
      margin-bottom: 5px;
      color: #555;
      font-size: 14px;
    }
    
    .info-box input { 
      width: 100%; 
      padding: 8px 12px;
      font-size: 14px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: #f9f9f9;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    .info-box input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    
    .info-box input[readonly] {
      background-color: #f0f0f0;
      color: #555;
    }
    
    .table-container {
      margin-top: 20px;
      overflow-x: auto;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    table { 
      width: 100%; 
      border-collapse: collapse; 
      min-width: 600px;
    }
    
    th, td { 
      border: 1px solid var(--border-color); 
      padding: 12px 10px;
      vertical-align: top;
      font-size: 14px;
    }
    
    th { 
      background-color: var(--primary-color); 
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.5px;
    }
    
    td input, td textarea { 
      width: 100%; 
      border: none; 
      font-family: inherit; 
      font-size: 14px;
      resize: none;
      background-color: transparent;
    }
    
    td textarea {
      min-height: 40px;
      height: 40px;
      max-height: 40px;
      line-height: 1.2;
    }
    
    .line-total {
      font-weight: 600;
      text-align: right;
    }
    
    .totals { 
      margin-top: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .totals label { 
      display: flex;
      align-items: center;
      margin-top: 10px;
      font-weight: 500;
    }
    
    .totals input { 
      padding: 8px;
      width: 200px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    
    .totals input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }
    
    .grand-total-container {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }
    
    .grand-total {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-color);
    }
    
    .terbilang { 
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px dashed var(--border-color);
      font-style: italic;
      color: #666;
    }
    
    .signature { 
      margin-top: 40px;
      text-align: right;
      padding-right: 40px;
      page-break-inside: avoid;
    }
    
    .signature-line {
      display: inline-block;
      width: 200px;
      border-top: 1px solid #333;
      margin-top: 5px;
    }
    
    .footer-print { 
      margin-top: 60px; 
      text-align: center; 
      font-style: italic; 
      font-size: 14px; 
      color: #666;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background-color: var(--success-color);
      color: white;
      border-radius: 5px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      transform: translateY(-100px);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification.error {
      background-color: var(--danger-color);
    }
    
    /* CSS untuk tampilan cetak yang lebih profesional */
    @page {
      size: A4 portrait;
      margin: 10mm;
    }
    
    @media print {
      /* Sembunyikan elemen yang tidak perlu saat cetak */
      body * {
        visibility: hidden;
      }
      
      .invoice-container, .invoice-container * {
        visibility: visible;
      }
      
      .invoice-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        border: none;
        box-shadow: none;
      }
      
      .button-bar { 
        display: none !important; 
      }
      
      /* Reset tampilan untuk cetak */
      body {
        margin: 0;
        padding: 0;
        background: white;
        font-size: 11pt;
        line-height: 1.4;
      }
      
      /* Ganti font dengan monospace seperti mesin tik */
      .invoice-container {
        font-family: 'Courier New', Courier, monospace !important;
      }
      
      /* Atur container invoice */
      .invoice-container {
        max-width: 100%;
        margin: 0 auto;
        padding: 15mm;
        border: none;
        box-shadow: none;
      }
      
      /* Pastikan input dan textarea tercetak dengan jelas */
      input, textarea, select {
        border: none !important;
        background: transparent !important;
        box-shadow: none !important;
        color: black !important;
        -webkit-appearance: none;
        appearance: none;
        font-weight: normal !important;
        font-family: 'Courier New', Courier, monospace !important;
        font-size: 11pt !important;
      }
      
      /* Atur tampilan header */
      .top-bar {
        display: flex !important;
        justify-content: space-between !important;
        align-items: flex-start !important;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
        margin-bottom: 15px;
        page-break-inside: avoid;
      }
      
      .company-info {
        flex: 1 !important;
        text-align: left !important;
      }
      
      .invoice-title {
        text-align: right !important;
        margin-left: auto !important;
        font-size: 28pt !important;
        font-weight: 900 !important;
        color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      
      /* Atur warna untuk tetap terlihat saat dicetak */
      .company-info h2 {
        color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        font-weight: bold !important;
        font-size: 16pt !important;
        font-weight: 800 !important;
        margin-bottom: 5px !important;
      }
      
      .company-info p {
        font-weight: 600 !important;
        margin: 2px 0 !important;
        font-size: 11pt !important;
      }
      
      /* Atur tampilan informasi pelanggan */
      .info-section {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        flex-wrap: nowrap !important;
        margin-bottom: 15px !important;
        page-break-inside: avoid;
        gap: 15px !important;
      }
      
      .info-box {
        flex: 1 !important;
        min-width: 30% !important;
        margin-bottom: 0 !important;
        page-break-inside: avoid;
      }
      
      .info-box label {
        font-weight: 700 !important;
        font-size: 11pt !important;
        margin-bottom: 3px !important;
        display: block !important;
      }
      
      .info-box input {
        font-weight: 600 !important;
        font-size: 11pt !important;
        padding: 3px 0 !important;
        width: 100% !important;
        border-bottom: 1px solid #000 !important;
      }
      
      /* Atur tampilan tabel */
      .table-container {
        overflow-x: visible !important;
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px !important;
        border: 1px solid #000 !important;
        min-width: auto !important;
      }
      
      thead {
        display: table-header-group;
      }
      
      tbody {
        display: table-row-group;
      }
      
      tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }
      
      th {
        background-color: #000 !important;
        color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        font-weight: 900 !important;
        border: 1px solid #000 !important;
        padding: 6px 8px !important;
        font-size: 10pt !important;
        text-align: left !important;
      }
      
      td {
        border: 1px solid #000 !important;
        vertical-align: top;
        padding: 6px 8px !important;
        font-size: 11pt !important;
      }
      
      /* Perbaikan untuk textarea agar tidak terpotong saat cetak */
      td textarea {
        min-height: auto !important;
        height: auto !important;
        max-height: none !important;
        overflow: visible !important;
        white-space: normal !important;
        text-overflow: clip !important;
        line-height: 1.4 !important;
        resize: none !important;
        word-wrap: break-word !important;
        padding: 3px 0 !important;
      }
      
      /* Pastikan sel tabel bisa memperluas sesuai konten */
      td {
        height: auto !important;
        vertical-align: top !important;
      }
      
      /* Pastikan baris tabel bisa memperluas tingginya sesuai konten */
      tr {
        height: auto !important;
        page-break-inside: avoid;
      }
      
      td input[type="number"], td input[type="text"] {
        height: auto !important;
        padding: 3px 0 !important;
        text-align: left !important;
      }
      
      .line-total {
        text-align: right !important;
        font-weight: 700 !important;
      }
      
      /* Atur tampilan bagian total */
      .totals {
        margin-top: 20px !important;
        padding: 10px !important;
        border-top: 1px solid #000 !important;
        border-bottom: 1px solid #000 !important;
        page-break-inside: avoid;
        font-size: 11pt !important;
        background: transparent !important;
      }
      
      .totals label {
        font-weight: 700 !important;
        font-size: 11pt !important;
        margin-top: 8px !important;
        margin-bottom: 3px !important;
        page-break-inside: avoid;
      }
      
      .totals input {
        border: none !important;
        background: transparent !important;
        font-weight: 600 !important;
        font-size: 11pt !important;
        padding: 0 !important;
        width: auto !important;
      }
      
      .totals input[type="checkbox"] {
        width: 12px !important;
        height: 12px !important;
      }
      
      .grand-total-container {
        margin-top: 10px !important;
        padding-top: 8px !important;
        border-top: 1px solid #000 !important;
        page-break-inside: avoid;
      }
      
      .grand-total {
        font-weight: 900 !important;
        font-size: 14pt !important;
        color: #000 !important;
      }
      
      /* Atur tampilan terbilang */
      .terbilang {
        margin-top: 15px !important;
        padding-top: 8px !important;
        border-top: 1px dashed #000 !important;
        font-size: 11pt !important;
        font-weight: 600 !important;
        page-break-inside: avoid;
      }
      
      /* Atur tampilan No Invoice DP */
      .totals label:nth-of-type(4),
      .totals label:nth-of-type(5) {
        display: block !important;
        margin-top: 8px !important;
        page-break-inside: avoid;
      }
      
      /* Buat wrapper khusus untuk rekening tujuan agar tidak terpotong */
      .rekening-wrapper {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin-top: 8px !important;
        margin-bottom: 5px !important;
        display: block !important;
        width: 100% !important;
      }
      
      /* Perbesar kotak rekening tujuan agar nama tidak terpotong */
      #rekeningTujuan {
        padding: 5px 0 !important;
        border: none !important;
        border-bottom: 1px solid #000 !important;
        font-size: 11pt !important;
        font-weight: 700 !important;
        text-transform: uppercase !important;
        background: transparent !important;
        color: #000 !important;
        margin-top: 3px !important;
        margin-bottom: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        min-width: 100% !important;
        overflow: visible !important;
        display: block !important;
        position: relative !important;
        z-index: 1 !important;
      }
      
      /* Atur tampilan tanda tangan */
      .signature {
        margin-top: 30px !important;
        padding-right: 40px;
        page-break-inside: avoid;
        font-size: 11pt !important;
        font-weight: 600 !important;
        text-align: right !important;
      }
      
      .signature-line {
        display: inline-block;
        width: 200px;
        border-top: 1px solid #000;
        margin-top: 5px;
      }
      
      /* Sembunyikan footer print yang fixed */
      .footer-print {
        display: none !important;
      }
      
      /* Tambahkan nomor halaman di footer */
      @page {
        @bottom-center {
          content: "Pacific Inter Teknologi - Halaman " counter(page) " dari " counter(pages);
          font-size: 10pt;
          font-family: 'Courier New', Courier, monospace;
          color: #000;
        }
      }
      
      /* Pastikan elemen penting tidak terpotong */
      .top-bar, .info-section, .totals, .signature, .terbilang, .rekening-wrapper {
        page-break-inside: avoid;
        break-inside: avoid;
      }
      
      /* Mencegah pemutusan halaman di tengah tabel */
      #itemTable {
        page-break-inside: avoid;
      }
      
      #itemTable tbody tr {
        page-break-after: auto;
        page-break-inside: avoid;
      }
      
      #itemTable thead {
        page-break-after: avoid;
      }
      
      /* Atur jarak antar elemen untuk keterbacaan */
      p, label, input, textarea {
        margin-bottom: 2px !important;
      }
      
      /* Mencegah pemutusan halaman yang tidak diinginkan */
      .page-break-avoid {
        page-break-inside: avoid;
      }
      
      /* Untuk konten yang panjang, pastikan bisa pindah halaman dengan baik */
      .allow-page-break {
        page-break-inside: auto;
      }
      
      /* Wrapper untuk invoice agar bisa dikontrol pemutusan halamannya */
      .invoice-wrapper {
        position: relative;
      }
      
      /* Halaman pertama - batasi tinggi maksimal */
      .first-page {
        max-height: 220mm; /* Sesuaikan dengan tinggi kertas A4 dikurangi margin */
        overflow: hidden;
      }
      
      /* Halaman lanjutan */
      .continuation-page {
        page-break-before: always;
        padding-top: 20mm; /* Tambahkan padding atas untuk halaman lanjutan */
      }
      
      /* Kelas untuk memaksa pemutusan halaman */
      .page-break-before {
        page-break-before: always;
      }
      
      /* Kelas untuk mencegah pemutusan halaman */
      .no-page-break {
        page-break-inside: avoid;
      }
      
      /* Tanda tangan di halaman lanjutan */
      .signature-continuation {
        margin-top: 10mm; /* Kurangi margin atas untuk halaman lanjutan */
        text-align: right;
        padding-right: 40px;
        page-break-inside: avoid;
        font-size: 11pt !important;
        font-weight: 600 !important;
      }
      
      .signature-continuation .signature-name {
        margin-top: 5px;
        font-weight: 700;
      }
      
      /* Perbaikan untuk mencegah duplikasi konten saat cetak */
      .print-only {
        display: none;
      }
      
      /* Header untuk halaman lanjutan - lebih sederhana */
      .continuation-header {
        display: none;
        text-align: center;
        margin-bottom: 15px;
        border-bottom: 1px solid #000;
        padding-bottom: 10px;
      }
      
      .continuation-header h2 {
        font-size: 16pt;
        font-weight: 700;
        margin-bottom: 5px;
      }
      
      @media print {
        .print-only {
          display: block !important;
        }
        
        .continuation-header {
          display: block !important;
        }
        
        /* Sembunyikan header lengkap di halaman lanjutan */
        .continuation-page .top-bar {
          display: none !important;
        }
        
        /* Sembunyikan info pelanggan di halaman lanjutan */
        .continuation-page .info-section {
          display: none !important;
        }
        
        /* Pastikan bagian total dan tanda tangan tidak terpisah */
        .totals-section {
          page-break-inside: avoid !important;
        }
        
        /* Tambahkan spasi di bagian bawah halaman lanjutan yang bukan halaman terakhir */
        .continuation-page:not(:last-child) .table-container {
          margin-bottom: 40mm !important;
        }
        
        /* Pastikan totals-section terlihat saat cetak */
        .totals-section {
          visibility: visible !important;
        }
      }
    }
    
    /* Tablet dan mobile device */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .invoice-container {
        padding: 15px;
      }
      
      .button-bar {
        justify-content: center;
      }
      
      .button-bar button {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      .top-bar {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
      
      .invoice-title {
        text-align: center;
        margin-left: 0;
        font-size: 24px;
      }
      
      .company-info h2 {
        font-size: 20px;
      }
      
      .info-section {
        flex-direction: column;
        gap: 15px;
      }
      
      .info-box {
        min-width: 100%;
        margin-bottom: 10px;
      }
      
      .table-container {
        margin: 15px 0;
        border-radius: 5px;
      }
      
      table {
        font-size: 13px;
      }
      
      th, td {
        padding: 8px 5px;
      }
      
      th {
        font-size: 11px;
      }
      
      td input, td textarea {
        font-size: 13px;
      }
      
      .totals {
        padding: 12px;
      }
      
      .totals input {
        width: 100%;
        max-width: 200px;
      }
      
      .grand-total {
        font-size: 16px;
      }
      
      .signature {
        margin-top: 30px;
        padding-right: 20px;
      }
      
      .signature-line {
        width: 150px;
      }
    }
    
    /* Mobile device kecil */
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      
      .invoice-container {
        padding: 12px;
      }
      
      .button-bar button {
        padding: 8px 10px;
        font-size: 12px;
      }
      
      .company-info p, .info-box label, .info-box input, th, td {
        font-size: 12px;
      }
      
      .company-info h2 {
        font-size: 18px;
      }
      
      .invoice-title {
        font-size: 20px;
      }
      
      .info-box {
        margin-bottom: 8px;
      }
      
      .table-container {
        margin: 12px 0;
      }
      
      th, td {
        padding: 6px 4px;
      }
      
      th {
        font-size: 10px;
      }
      
      td input, td textarea {
        font-size: 12px;
      }
      
      .totals {
        padding: 10px;
        font-size: 13px;
      }
      
      .totals input {
        max-width: 150px;
      }
      
      .grand-total {
        font-size: 15px;
      }
      
      .terbilang {
        font-size: 12px;
      }
      
      .signature {
        margin-top: 25px;
        padding-right: 15px;
      }
      
      .signature-line {
        width: 120px;
      }
    }
  </style>
</head>
<body onload="loadInvoice()">
  <!-- Check Login -->
  <script>
    // Check if user is logged in
    const currentUser = localStorage.getItem("currentUser");
    if (!currentUser) {
      window.location.href = "login.html";
    }
  </script>
  <div class="invoice-container">
    <div class="button-bar">
      <button onclick="goBack()">
        <i class="fas fa-arrow-left"></i> Kembali
      </button>
      <button onclick="addItem()">
        <i class="fas fa-plus"></i> Tambah Item
      </button>
      <button onclick="removeLastItem()" class="danger">
        <i class="fas fa-trash"></i> Hapus Item
      </button>
      <button onclick="saveInvoice()" class="success">
        <i class="fas fa-save"></i> Simpan
      </button>
      <button onclick="prepareForPrint()">
        <i class="fas fa-print"></i> Cetak
      </button>
    </div>
    
    <div class="invoice-wrapper">
      <div class="first-page">
        <div class="top-bar page-break-avoid">
          <div class="company-info">
            <h2>PACIFIC INTER TEKNOLOGI</h2>
            <p>Kirana Two Office Tower Lt.10 Unit A</p>
            <p>Jl. Boulevard Timur No.88, Jakarta Utara</p>
            <p>Telp: +62 81808283379</p>
          </div>
          <div class="invoice-title">INVOICE</div>
        </div>
        
        <!-- Bagian informasi pelanggan yang akan disusun horizontal -->
        <div class="info-section page-break-avoid">
          <div class="info-box">
            <label>Invoice To</label>
            <input type="text" id="namaPelanggan" readonly>
            <label>Address</label>
            <input type="text" id="alamatPelanggan" readonly>
          </div>
          <div class="info-box">
            <label>Invoice No</label>
            <input type="text" id="noInvoice" readonly>
            <label>Date</label>
            <input type="text" id="tanggalInvoice" readonly>
          </div>
          <div class="info-box">
            <label>Contact Number</label>
            <input type="text" id="telpPelanggan" readonly>
            <label>Term of Payment</label>
            <input type="text" id="termOfPayment" readonly>
          </div>
        </div>
        
        <div class="table-container">
          <table id="itemTable" class="page-break-avoid">
            <thead>
              <tr>
                <th style="width: 45%;">Item</th>
                <th style="width: 7%;">Qty</th>
                <th style="width: 8%;">Unit</th>
                <th style="width: 20%;">Unit Price</th>
                <th style="width: 20%;">Total</th>
              </tr>
            </thead>
            <tbody class="allow-page-break"></tbody>
          </table>
        </div>
        
        <!-- Wrapper untuk bagian bawah agar tidak terpisah -->
        <div class="totals-section page-break-avoid" id="totalsSection">
          <div class="totals">
            <label>Discount (Rp): <input type="number" id="diskon" value="0" oninput="updateTotal()"></label>
            <label><input type="checkbox" id="ppn" onchange="updateTotal()"> Add PPN 11%</label>
            <label><input type="checkbox" id="gunakanDP" onchange="updateTotal()"> Gunakan Down Payment</label>
            
            <div class="grand-total-container">
              <strong>Sub Total:</strong> <span id="grandTotal" class="grand-total">Rp 0</span>
            </div>
            <div class="terbilang" id="terbilangText">Terbilang: Nol Rupiah</div>
            
            <!-- Pindahkan No Invoice DP dan Rekening Tujuan ke bawah Terbilang -->
            <label>No Invoice DP: <input type="text" id="noInvoiceDP" /></label>
            
            <!-- Bungkus rekening tujuan dengan wrapper khusus -->
            <div class="rekening-wrapper">
              <label>Rekening Tujuan:</label>
              <input type="text" id="rekeningTujuan" />
            </div>
          </div>
          
          <div class="signature" id="signatureSection">
            Hormat Kami,<br><br><br><br>
            <strong>ALFIANTO</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Elemen untuk header halaman lanjutan saat cetak (hanya terlihat saat cetak) -->
  <div class="print-only continuation-header">
    <h2>INVOICE</h2>
    <p>PACIFIC INTER TEKNOLOGI</p>
  </div>
  
  <div class="footer-print">
    Terima kasih atas transaksi Anda.
  </div>
  
  <div id="notification" class="notification"></div>
  
  <script>
    // Fungsi untuk menampilkan notifikasi
    function showNotification(message, type = 'success') {
      const notification = document.getElementById("notification");
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add("show");
      
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }
    
    // Fungsi untuk memuat data invoice
    function loadInvoice() {
      const pelanggan = JSON.parse(localStorage.getItem("selectedInvoice")) || {};
      const jenis = JSON.parse(localStorage.getItem("jenisInvoiceTerpilih")) || {};
      
      document.getElementById("namaPelanggan").value = pelanggan.nama || "";
      document.getElementById("alamatPelanggan").value = pelanggan.alamat || "";
      document.getElementById("telpPelanggan").value = pelanggan.telp || "";
      document.getElementById("noInvoice").value = jenis.noInvoice || "";
      document.getElementById("termOfPayment").value = jenis.top || "";
      document.getElementById("noInvoiceDP").value = jenis.noInvoiceDP || "";
      document.getElementById("rekeningTujuan").value = jenis.rekening || "";
      
      // Format tanggal untuk tampilan
      const tanggal = pelanggan.tanggal || new Date().toISOString().split("T")[0];
      const formattedDate = new Date(tanggal).toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      });
      document.getElementById("tanggalInvoice").value = formattedDate;
      
      // Tambahkan item default jika belum ada
      const tbody = document.querySelector("#itemTable tbody");
      if (tbody.children.length === 0) {
        addItem();
      }
    }
    
    // Fungsi untuk menambah item baru
    function addItem() {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><textarea rows="2" placeholder="Deskripsi item..." oninput="updateTotal()"></textarea></td>
        <td><input type="number" value="1" min="1" oninput="updateTotal()"></td>
        <td><input type="text" value="pcs" oninput="updateTotal()"></td>
        <td><input type="number" value="0" min="0" oninput="updateTotal()"></td>
        <td class="line-total">Rp 0</td>
      `;
      document.querySelector("#itemTable tbody").appendChild(row);
      updateTotal();
    }
    
    // Fungsi untuk menghapus item terakhir
    function removeLastItem() {
      const tbody = document.querySelector("#itemTable tbody");
      if (tbody.children.length > 1) {
        tbody.removeChild(tbody.lastChild);
        updateTotal();
      } else {
        showNotification("Minimal harus ada satu item", "error");
      }
    }
    
    // Fungsi untuk mengupdate total
    function updateTotal() {
      let total = 0;
      const rows = document.querySelectorAll("#itemTable tbody tr");
      
      rows.forEach((row) => {
        const deskripsi = row.cells[0].querySelector("textarea").value.trim();
        const qty = parseFloat(row.cells[1].querySelector("input").value) || 0;
        const harga = parseFloat(row.cells[3].querySelector("input").value) || 0;
        const sub = qty * harga;
        row.cells[4].textContent = "Rp " + sub.toLocaleString("id-ID");
        total += sub;
      });
      
      // Kurangi diskon
      const diskon = parseFloat(document.getElementById("diskon").value) || 0;
      total -= diskon;
      
      // Tambah PPN jika dicentang
      if (document.getElementById("ppn").checked) {
        total *= 1.11;
      }
      
      // Kurangi DP jika dicentang
      if (document.getElementById("gunakanDP").checked) {
        total -= 1000000;
      }
      
      // Update tampilan total
      document.getElementById("grandTotal").textContent = "Rp " + total.toLocaleString("id-ID");
      document.getElementById("terbilangText").textContent = "Terbilang: " + terbilang(total) + " Rupiah";
    }
    
    // Fungsi untuk mengkonversi angka ke terbilang
    function terbilang(nilai) {
      const angka = ["", "Satu", "Dua", "Tiga", "Empat", "Lima", "Enam", "Tujuh", "Delapan", "Sembilan"];
      const satuan = ["", "Ribu", "Juta", "Miliar", "Triliun"];
      
      if (nilai === 0) return "Nol";
      
      let hasil = "", i = 0;
      while (nilai > 0) {
        let temp = nilai % 1000, str = "", r = Math.floor(temp/100), p = Math.floor((temp%100)/10), s = temp%10;
        
        if (r > 0) str += (r === 1 ? "Seratus " : angka[r] + " Ratus ");
        if (p === 1) str += s === 0 ? "Sepuluh " : s === 1 ? "Sebelas " : angka[s] + " Belas ";
        else {
          if (p > 0) str += angka[p] + " Puluh ";
          if (s > 0) str += angka[s] + " ";
        }
        
        hasil = str + satuan[i] + " " + hasil;
        nilai = Math.floor(nilai / 1000); 
        i++;
      }
      
      return hasil.trim();
    }
    
    // Fungsi untuk menyimpan invoice
    function saveInvoice() {
      updateTotal();
      
      // Ambil data dari form
      const rows = document.querySelectorAll("#itemTable tbody tr");
      let items = [];
      
      rows.forEach((row, index) => {
        const deskripsi = row.cells[0].querySelector("textarea").value.trim();
        const qty = parseFloat(row.cells[1].querySelector("input").value) || 0;
        const unit = row.cells[2].querySelector("input").value.trim();
        const harga = parseFloat(row.cells[3].querySelector("input").value) || 0;
        
        if (deskripsi && qty > 0 && harga > 0) {
          items.push({
            deskripsi,
            qty,
            unit,
            harga,
            total: qty * harga
          });
        }
      });
      
      if (items.length === 0) {
        showNotification("Harap isi minimal satu item", "error");
        return;
      }
      
      const totalText = document.getElementById("grandTotal").textContent;
      const total = parseInt(totalText.replace(/[^\d]/g, '')) || 0;
      
      // Siapkan data invoice
      const data = {
        tanggal: document.getElementById("tanggalInvoice").value,
        noInvoice: document.getElementById("noInvoice").value,
        customer: document.getElementById("namaPelanggan").value,
        alamat: document.getElementById("alamatPelanggan").value,
        telp: document.getElementById("telpPelanggan").value,
        termOfPayment: document.getElementById("termOfPayment").value,
        items: items,
        diskon: parseFloat(document.getElementById("diskon").value) || 0,
        ppn: document.getElementById("ppn").checked,
        gunakanDP: document.getElementById("gunakanDP").checked,
        noInvoiceDP: document.getElementById("noInvoiceDP").value,
        rekeningTujuan: document.getElementById("rekeningTujuan").value,
        total: total,
        status: "Belum Lunas",
        tanggalPelunasan: ""
      };
      
      // Simpan ke dataPenjualan
      const penjualan = JSON.parse(localStorage.getItem("dataPenjualan")) || [];
      penjualan.push(data);
      localStorage.setItem("dataPenjualan", JSON.stringify(penjualan));
      
      // Simpan ke dataJurnal
      const jurnal = JSON.parse(localStorage.getItem("dataJurnal")) || [];
      
      // Entri untuk pendapatan
      jurnal.push({
        tanggal: data.tanggal,
        akun: "Pendapatan Jasa",
        keterangan: `Penjualan - ${data.customer}`,
        debit: 0,
        kredit: total,
        noInvoice: data.noInvoice
      });
      
      // Entri untuk kas/piutang
      jurnal.push({
        tanggal: data.tanggal,
        akun: data.termOfPayment === "Cash" ? "Kas" : "Piutang Usaha",
        keterangan: `Penjualan - ${data.customer}`,
        debit: total,
        kredit: 0,
        noInvoice: data.noInvoice
      });
      
      localStorage.setItem("dataJurnal", JSON.stringify(jurnal));
      
      // Simpan ke dataLaporan agar terbaca di jurnal.html & laporan.html
      const laporan = JSON.parse(localStorage.getItem("dataLaporan")) || [];
      
      laporan.push({
        tanggal: data.tanggal,
        deskripsi: `Penjualan ke ${data.customer}`,
        akun: "Pendapatan Jasa",
        status: "kredit",
        jumlah: total,
        noInvoice: data.noInvoice
      });
      
      laporan.push({
        tanggal: data.tanggal,
        deskripsi: `Penjualan ke ${data.customer}`,
        akun: data.termOfPayment === "Cash" ? "Kas" : "Piutang Usaha",
        status: "debit",
        jumlah: total,
        noInvoice: data.noInvoice
      });
      
      localStorage.setItem("dataLaporan", JSON.stringify(laporan));
      
      // Simpan ke laporanKeuangan untuk integrasi dengan neraca
      const laporanKeuangan = JSON.parse(localStorage.getItem("laporanKeuangan")) || [];
      
      laporanKeuangan.push({
        tanggal: data.tanggal,
        akun: "Pendapatan Jasa",
        nilai: total,
        keterangan: `Penjualan - ${data.customer}`,
        tipe: "kredit",
        noInvoice: data.noInvoice
      });
      
      laporanKeuangan.push({
        tanggal: data.tanggal,
        akun: data.termOfPayment === "Cash" ? "Kas" : "Piutang Usaha",
        nilai: total,
        keterangan: `Penjualan - ${data.customer}`,
        tipe: "debit",
        noInvoice: data.noInvoice
      });
      
      localStorage.setItem("laporanKeuangan", JSON.stringify(laporanKeuangan));
      
      showNotification("✅ Invoice berhasil disimpan ke laporan penjualan & jurnal.");
    }
    
    // Fungsi untuk kembali ke halaman sebelumnya
    function goBack() {
      window.location.href = "jenis-invoice.html";
    }
    
    // Fungsi untuk menyiapkan invoice sebelum dicetak
    function prepareForPrint() {
      const rows = document.querySelectorAll("#itemTable tbody tr");
      const itemCount = rows.length;
      
      // Hapus semua halaman lanjutan yang mungkin sudah ada
      const existingContinuationPages = document.querySelectorAll('.continuation-page');
      existingContinuationPages.forEach(page => page.remove());
      
      // Sesuaikan tinggi semua textarea berdasarkan kontennya
      const textareas = document.querySelectorAll('td textarea');
      textareas.forEach(textarea => {
        // Simpan nilai asli
        const originalValue = textarea.value;
        
        // Sementara atur height ke auto untuk menghitung tinggi yang dibutuhkan
        textarea.style.height = 'auto';
        
        // Kembalikan nilai asli
        textarea.value = originalValue;
        
        // Atur tinggi berdasarkan scrollHeight
        textarea.style.height = textarea.scrollHeight + 'px';
      });
      
      // Jika item lebih dari 8, pindahkan sebagian item ke halaman baru
      if (itemCount > 8) {
        // Sembunyikan bagian total dan tanda tangan di halaman pertama
        const totalsSection = document.getElementById('totalsSection');
        totalsSection.style.display = "none";
        
        // Pindahkan item melebihi batas ke halaman baru
        const tbody = document.querySelector("#itemTable tbody");
        const itemsPerPage = 8;
        let continuationPages = [];
        
        // Buat halaman lanjutan untuk setiap 8 item tambahan
        for (let i = itemsPerPage; i < itemCount; i += itemsPerPage) {
          const continuationPage = document.createElement('div');
          continuationPage.className = 'continuation-page';
          
          // Tambahkan header sederhana untuk halaman lanjutan
          const continuationHeader = document.querySelector('.continuation-header').cloneNode(true);
          continuationPage.appendChild(continuationHeader);
          
          // Buat tabel baru untuk halaman lanjutan
          const tableContainer = document.createElement('div');
          tableContainer.className = 'table-container';
          
          const newTable = document.createElement('table');
          newTable.id = 'itemTable' + (i/itemsPerPage);
          
          // Salin header tabel
          const thead = document.createElement('thead');
          thead.innerHTML = `
            <tr>
              <th style="width: 45%;">Item</th>
              <th style="width: 7%;">Qty</th>
              <th style="width: 8%;">Unit</th>
              <th style="width: 20%;">Unit Price</th>
              <th style="width: 20%;">Total</th>
            </tr>
          `;
          newTable.appendChild(thead);
          
          // Buat tbody baru
          const newTbody = document.createElement('tbody');
          
          // Pindahkan item ke halaman lanjutan
          for (let j = 0; j < itemsPerPage && (i + j) < itemCount; j++) {
            const row = tbody.children[itemsPerPage].cloneNode(true); // Ambil dari index tetap karena elemen berkurang
            newTbody.appendChild(row);
          }
          
          newTable.appendChild(newTbody);
          tableContainer.appendChild(newTable);
          continuationPage.appendChild(tableContainer);
          
          // Simpan halaman lanjutan untuk diproses nanti
          continuationPages.push({
            element: continuationPage,
            isLast: (i + itemsPerPage >= itemCount)
          });
          
          // Tambahkan halaman lanjutan ke wrapper
          document.querySelector('.invoice-wrapper').appendChild(continuationPage);
          
          // Hapus item yang sudah dipindahkan dari tabel asli
          for (let j = 0; j < itemsPerPage && (i + j) < itemCount; j++) {
            tbody.removeChild(tbody.children[itemsPerPage]); // Selalu hapus dari index yang sama karena elemen berkurang
          }
        }
        
        // Tambahkan bagian total dan tanda tangan hanya di halaman terakhir
        const lastPage = continuationPages[continuationPages.length - 1];
        if (lastPage && lastPage.isLast) {
          // Salin bagian total dan tanda tangan
          const totalsSectionCopy = totalsSection.cloneNode(true);
          totalsSectionCopy.style.display = "block"; // Pastikan terlihat
          lastPage.element.appendChild(totalsSectionCopy);
        }
        
        // Tambahkan kelas untuk memberi spasi di bagian bawah halaman yang bukan terakhir
        continuationPages.forEach(page => {
          if (!page.isLast) {
            page.element.classList.add('not-last-page');
          }
        });
      }
      
      // Cetak dokumen
      window.print();
      
      // Kembalikan tata letak asli setelah cetak
      setTimeout(() => {
        // Hapus halaman lanjutan
        const continuationPages = document.querySelectorAll('.continuation-page');
        continuationPages.forEach(page => page.remove());
        
        // Tampilkan kembali bagian total dan tanda tangan di halaman pertama
        const totalsSection = document.getElementById('totalsSection');
        totalsSection.style.display = "block";
        
        // Muat kembali data untuk mengembalikan item yang dipindahkan
        loadInvoice();
      }, 1000);
    }
  </script>
</body>
</html>